--PRIMEIRA QUESTAO
CREATE VIEW VW_FUNCIONARIO AS
		SELECT MATRICULA, NM_FUNCIONARIO, SEXO, CD_SETOR
		FROM TB_FUNCIONARIO

CREATE VIEW VW_FUNCIONARIO_COMPLETO AS
	SELECT MATRICULA, NM_FUNCIONARIO, SEXO, SALARIO, TF.CD_SETOR,
	TS.NM_SETOR, TS.CD_DEPARTAMENTO, TD.NM_DEPARTAMENTO
	FROM TB_FUNCIONARIO TF
	INNER JOIN TB_SETOR TS
	ON (TF.CD_SETOR = TS.CD_SETOR)
	INNER JOIN TB_DEPARTAMENTO TD
	ON (TS.CD_DEPARTAMENTO = TS.CD_DEPARTAMENTO)
	
CREATE VIEW VW_SETOR AS
	SELECT TS.CD_SETOR, TS.NM_SETOR, TS.NM_GERENTE, TD.NM_DEPARTAMENTO 
	FROM TB_SETOR TS
	INNER JOIN TB_DEPARTAMENTO TD
	ON (TS.CD_DEPARTAMENTO = TD.CD_DEPARTAMENTO)
	WHERE (TS.CD_SETOR)
	IN 
	(
		SELECT TF.CD_SETOR FROM TB_FUNCIONARIO TF
	)
	
CREATE VIEW VW_TOTAL_SOLICITACAO_DEPARTAMENTO AS
	SELECT TD.NM_DEPARTAMENTO, COUNT (TSL.CD_SOLICITACAO) AS 'QUANTIDADE SOLICITACOES' FROM TB_SOLICITACAO TSL
	INNER JOIN TB_FUNCIONARIO TF 
	ON (TF.MATRICULA = TSL.MATRICULA) 
	INNER JOIN TB_SETOR TS
	ON (TF.CD_SETOR = TS.CD_SETOR)
	INNER JOIN TB_DEPARTAMENTO TD
	ON (TS.CD_DEPARTAMENTO = TD.CD_DEPARTAMENTO)
	GROUP BY TD.NM_DEPARTAMENTO
	 
CREATE VIEW VW_DEPARTAMENTOS_MAIORES_SOLICITACOES AS
	SELECT VW.NM_DEPARTAMENTO, VW."QUANTIDADE SOLICITACOES" 
	FROM VW_TOTAL_SOLICITACAO_DEPARTAMENTO VW
	WHERE VW."QUANTIDADE SOLICITACOES" =
	(
		SELECT MAX(VW."QUANTIDADE SOLICITACOES") FROM VW_TOTAL_SOLICITACAO_DEPARTAMENTO VW
	)
	 

--SEGUNDA QUESTAO
--CODIGO INSERT

INSERT INTO "TB_LIVRO" ("CD_LIVRO", "NM_LIVRO", "ISBN", "ANO", "DATA_CADASTRO") VALUES (1, 'JAVA: COMO PROGRAMAR', 1212, 2015, '13/04/2015 20:27:10');
INSERT INTO "TB_LIVRO" ("CD_LIVRO", "NM_LIVRO", "ISBN", "ANO", "DATA_CADASTRO") VALUES (2, 'C++ A BIBLIA', 1202, 2008, '13/04/2015 20:27:34');
INSERT INTO "TB_LIVRO" ("CD_LIVRO", "NM_LIVRO", "ISBN", "ANO", "DATA_CADASTRO") VALUES (3, 'REFATORACAO', 1001, 2008, '13/04/2015 20:27:58');

--CRIACAO DA VIEW

CREATE VIEW VW_LIVRO AS 
SELECT CD_LIVRO, NM_LIVRO, ISBN, ANO
FROM TB_LIVRO

-- TENTATIVA DE INSERÇÃO NA VIEW

INSERT INTO VW_LIVRO ("CD_LIVRO", "NM_LIVRO", "ISBN", "ANO") VALUES (4, 'HARRY POTTER', 10121, 2008);

